
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Budget Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      /* Background image using your uploaded image */
      background-image: url('Baby.jpeg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-color: #1a1a1a; /* Fallback dark background */
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4); /* Dark overlay - adjust opacity as needed */
      z-index: -1;
      pointer-events: none;
    }

    h1 {
      margin-bottom: 2rem;
      color: white;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
      font-size: 2.8rem;
      font-weight: 200;
      letter-spacing: 3px;
      text-align: center;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      text-transform: uppercase;
      opacity: 0.95;
    }

    #budgetChart {
      max-width: 350px;
      margin: 1rem auto;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      margin: 1.5rem auto;
      max-width: 500px;
      color: white;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .input-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    select, input, button, textarea {
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 1rem;
      backdrop-filter: blur(10px);
      min-width: 200px;
    }

    select option {
      background: rgba(0, 0, 0, 0.95);
      color: white;
    }

    input::placeholder, textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    button {
      background: rgba(255, 255, 255, 0.1);
      cursor: pointer;
      border: 2px solid rgba(255, 255, 255, 0.2);
      font-weight: bold;
      transition: all 0.3s ease;
      min-width: 200px;
    }

    button:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .delete-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      padding: 0.5rem;
      min-width: auto;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.2rem;
    }

    .delete-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .summary {
      margin-top: 1.5rem;
      font-size: 1.1rem;
      line-height: 1.8;
    }

    .positive { 
      color: #ffffff; 
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    
    .negative { 
      color: #ffeb3b; 
      text-shadow: 0 0 15px rgba(255, 235, 59, 0.8), 0 0 30px rgba(255, 235, 59, 0.4);
    }

    .transactions-list {
      margin-top: 2rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .transaction-item {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(8px);
      margin: 0.5rem 0;
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-align: left;
      transition: all 0.3s ease;
    }

    .transaction-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .transaction-details {
      flex-grow: 1;
    }

    .transaction-amount {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .transaction-description {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 0.3rem;
    }

    .transaction-date {
      font-size: 0.8rem;
      opacity: 0.6;
    }

    .category-filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
      min-width: auto;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .filter-btn.active {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.4);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .custom-category-input {
      display: none;
      margin-top: 0.5rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(8px);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .budget-warning {
      color: #ffeb3b !important;
      text-shadow: 0 0 15px rgba(255, 235, 59, 0.8) !important;
      animation: pulse 2s infinite;
    }

    .budget-exceeded {
      color: #ff6b6b !important;
      text-shadow: 0 0 15px rgba(255, 107, 107, 0.8) !important;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Opening animations */
    h1 {
      animation: fadeInDown 1s ease-out;
    }

    .glass-card {
      opacity: 0;
      animation: fadeInUp 0.8s ease-out forwards;
    }

    .glass-card:nth-child(1) { animation-delay: 0.2s; }
    .glass-card:nth-child(2) { animation-delay: 0.4s; }
    .glass-card:nth-child(3) { animation-delay: 0.6s; }
    .glass-card:nth-child(4) { animation-delay: 0.8s; }

    /* Scroll reveal animations */
    .scroll-reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .scroll-reveal.revealed {
      opacity: 1;
      transform: translateY(0);
    }

    .scroll-reveal-left {
      opacity: 0;
      transform: translateX(-50px);
      transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .scroll-reveal-left.revealed {
      opacity: 1;
      transform: translateX(0);
    }

    .scroll-reveal-right {
      opacity: 0;
      transform: translateX(50px);
      transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .scroll-reveal-right.revealed {
      opacity: 1;
      transform: translateX(0);
    }

    .transaction-item {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .transaction-item.animate-in {
      opacity: 1;
      transform: translateY(0);
    }

    .stat-item {
      transition: all 0.3s ease, transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .stat-item:hover {
      transform: translateY(-5px) scale(1.02);
    }

    /* Chart animation */
    #budgetChart {
      animation: scaleIn 1s ease-out 0.5s both;
    }

    /* Transaction type selector styles */
    .transaction-type-selector {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .radio-option {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      min-width: 120px;
      justify-content: center;
    }

    .radio-option:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }

    .radio-option input[type="radio"] {
      margin-right: 0.5rem;
      min-width: auto;
      width: auto;
      accent-color: #ffffff;
    }

    .radio-option input[type="radio"]:checked + .radio-label {
      color: #ffffff;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    }

    .radio-option:has(input[type="radio"]:checked) {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.6);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    .radio-label {
      color: rgba(255, 255, 255, 0.8);
      font-weight: bold;
      transition: all 0.3s ease;
    }
  </style>
</head>
<body>

  <h1>K&D's Money Tracker</h1>

  <div class="glass-card">
    <canvas id="budgetChart"></canvas>
    
    <div class="summary" id="summaryDisplay">
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value positive" id="incomeValue">‚Ç±0</div>
          <div class="stat-label">üè¶ Total Income</div>
        </div>
        <div class="stat-item">
          <div class="stat-value negative" id="expenseValue">‚Ç±0</div>
          <div class="stat-label">üí∏ Total Expenses</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="remainingValue">‚Ç±0</div>
          <div class="stat-label">üí∞ Remaining</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="transactionCount">0</div>
          <div class="stat-label">üìä Transactions</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="dailyBudgetValue">‚Ç±0</div>
          <div class="stat-label">üìÖ Daily Budget</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="dailySpentValue">‚Ç±0</div>
          <div class="stat-label">‚è±Ô∏è Today's Spent</div>
        </div>
      </div>
    </div>
  </div>

  <div class="glass-card scroll-reveal">
    <h3>Daily Budget Settings</h3>
    <div class="input-group">
      <div class="input-row">
        <input type="number" id="dailyBudgetInput" placeholder="Set daily budget (‚Ç±)" step="0.01" />
        <button onclick="setDailyBudget()">üí∞ Set Daily Budget</button>
      </div>
    </div>
  </div>

  <div class="glass-card scroll-reveal-left">
    <h3>Add New Transaction</h3>
    
    <div class="input-group">
      <div class="transaction-type-selector">
        <label class="radio-option">
          <input type="radio" name="transactionType" value="income" id="incomeRadio" checked>
          <span class="radio-label">üí∞ Income</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="transactionType" value="expense" id="expenseRadio">
          <span class="radio-label">üí∏ Expense</span>
        </label>
      </div>
      
      <div class="input-row">
        <input type="text" id="categoryInput" placeholder="What type? (e.g., Salary, Food, Transport)" />
        <input type="number" id="amount" placeholder="Enter amount (‚Ç±)" step="0.01" />
      </div>
      
      <textarea id="description" placeholder="Add description (optional)"></textarea>
      
      <button onclick="addTransaction()">üíæ Add Transaction</button>
    </div>
  </div>

  <div class="glass-card scroll-reveal-right">
    <h3>Transaction History</h3>
    
    <div class="category-filters" id="categoryFilters">
      <button class="filter-btn active" onclick="filterTransactions('All')">All</button>
      <button class="filter-btn" onclick="filterTransactions('Income')">Income</button>
      <button class="filter-btn" onclick="filterTransactions('Expenses')">Expenses</button>
    </div>
    
    <div class="transactions-list" id="transactionsList">
      <p style="opacity: 0.7;">No transactions yet. Add your first transaction above!</p>
    </div>
  </div>

  <script>
    let totalIncome = 0;
    let totalExpenses = 0;
    let transactions = [];
    let currentFilter = 'All';
    let dailyBudget = 0;
    let dailyExpenses = 0;

    const ctx = document.getElementById('budgetChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Remaining', 'Spent'],
        datasets: [{
          data: [1, 0],
          backgroundColor: ['#ffffff', '#ffeb3b'],
          borderWidth: 0,
          hoverBorderWidth: 2,
          hoverBorderColor: 'rgba(255,255,255,0.8)'
        }]
      },
      options: {
        cutout: '70%',
        animation: { animateScale: true },
        plugins: {
          legend: {
            display: true,
            position: 'bottom',
            labels: {
              color: 'white',
              font: { size: 14 }
            }
          }
        }
      }
    });

    // Handle transaction type selection
    document.querySelectorAll('input[name="transactionType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const categoryInput = document.getElementById('categoryInput');
        if (this.value === 'income') {
          categoryInput.placeholder = "What type of income? (e.g., Salary, Freelance, Gift)";
        } else {
          categoryInput.placeholder = "What type of expense? (e.g., Food, Transport, Entertainment)";
        }
      });
    });

    function formatNumber(num) {
      if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
      }
      return num.toFixed(2);
    }

    function updateChart() {
      const remaining = Math.max(0, totalIncome - totalExpenses);
      chart.data.datasets[0].data = [remaining, totalExpenses];
      
      // Dynamic color based on budget status
      if (remaining <= totalIncome * 0.1) {
        chart.data.datasets[0].backgroundColor[0] = '#888888'; // Gray when very low
        chart.data.datasets[0].backgroundColor[1] = '#ffeb3b'; // Yellow for expenses
      } else if (remaining <= totalIncome * 0.3) {
        chart.data.datasets[0].backgroundColor[0] = '#bbbbbb'; // Light gray when low
        chart.data.datasets[0].backgroundColor[1] = '#ffeb3b'; // Yellow for expenses
      } else {
        chart.data.datasets[0].backgroundColor[0] = '#ffffff'; // White when good
        chart.data.datasets[0].backgroundColor[1] = '#ffeb3b'; // Yellow for expenses
      }
      
      chart.update();

      // Calculate daily expenses (transactions from today)
      const today = new Date().toDateString();
      dailyExpenses = transactions
        .filter(t => t.type === 'expense' && new Date(t.rawDate).toDateString() === today)
        .reduce((sum, t) => sum + t.amount, 0);

      // Update stats
      document.getElementById('incomeValue').textContent = `‚Ç±${formatNumber(totalIncome)}`;
      document.getElementById('expenseValue').textContent = `‚Ç±${formatNumber(totalExpenses)}`;
      document.getElementById('remainingValue').textContent = `‚Ç±${formatNumber(remaining)}`;
      document.getElementById('transactionCount').textContent = transactions.length;
      document.getElementById('dailyBudgetValue').textContent = `‚Ç±${formatNumber(dailyBudget)}`;
      document.getElementById('dailySpentValue').textContent = `‚Ç±${formatNumber(dailyExpenses)}`;

      // Update daily spent color based on budget status
      const dailySpentElement = document.getElementById('dailySpentValue');
      if (dailyBudget > 0) {
        if (dailyExpenses >= dailyBudget) {
          dailySpentElement.className = 'stat-value budget-exceeded';
        } else if (dailyExpenses >= dailyBudget * 0.8) {
          dailySpentElement.className = 'stat-value budget-warning';
        } else {
          dailySpentElement.className = 'stat-value negative';
        }
      } else {
        dailySpentElement.className = 'stat-value negative';
      }
      
      // Color the remaining value based on budget status
      const remainingElement = document.getElementById('remainingValue');
      if (remaining <= totalIncome * 0.1) {
        remainingElement.className = 'stat-value negative';
      } else if (remaining <= totalIncome * 0.3) {
        remainingElement.className = 'stat-value';
        remainingElement.style.color = '#bbbbbb';
      } else {
        remainingElement.className = 'stat-value positive';
      }
    }

    function addTransaction() {
      const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
      const category = document.getElementById('categoryInput').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);
      const description = document.getElementById('description').value.trim();

      if (!amount || amount <= 0) {
        alert("Please enter a valid amount.");
        return;
      }

      if (!category) {
        alert("Please enter what type of " + transactionType + " this is.");
        return;
      }

      const transaction = {
        id: Date.now(),
        category: category,
        amount: amount,
        description: description || 'No description',
        date: new Date().toLocaleString(),
        rawDate: new Date(),
        type: transactionType
      };

      transactions.unshift(transaction); // Add to beginning of array

      if (transactionType === 'income') {
        totalIncome += amount;
      } else {
        totalExpenses += amount;
      }

      // Clear form
      document.getElementById('categoryInput').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('description').value = '';

      updateChart();
      displayTransactions();
    }

    function deleteTransaction(id) {
      const transaction = transactions.find(t => t.id === id);
      if (!transaction) return;

      if (confirm('Are you sure you want to delete this transaction?')) {
        transactions = transactions.filter(t => t.id !== id);
        
        if (transaction.type === 'income') {
          totalIncome -= transaction.amount;
        } else {
          totalExpenses -= transaction.amount;
        }

        updateChart();
        displayTransactions();
      }
    }

    function filterTransactions(filter) {
      currentFilter = filter;
      
      // Update filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      displayTransactions();
    }

    function displayTransactions() {
      const container = document.getElementById('transactionsList');
      let filteredTransactions = transactions;

      if (currentFilter === 'Income') {
        filteredTransactions = transactions.filter(t => t.type === 'income');
      } else if (currentFilter === 'Expenses') {
        filteredTransactions = transactions.filter(t => t.type === 'expense');
      }

      if (filteredTransactions.length === 0) {
        container.innerHTML = '<p style="opacity: 0.7;">No transactions found for this filter.</p>';
        return;
      }

      container.innerHTML = filteredTransactions.map(transaction => `
        <div class="transaction-item">
          <div class="transaction-details">
            <div class="transaction-amount ${transaction.type === 'income' ? 'positive' : 'negative'}">
              ${transaction.type === 'income' ? '+' : '-'}‚Ç±${formatNumber(transaction.amount)}
            </div>
            <div><strong>${transaction.category}</strong></div>
            <div class="transaction-description">${transaction.description}</div>
            <div class="transaction-date">${transaction.date}</div>
          </div>
          <button class="delete-btn" onclick="deleteTransaction(${transaction.id})" title="Delete transaction">
            üóëÔ∏è
          </button>
        </div>
      `).join('');
    }

    function setDailyBudget() {
      const budgetInput = document.getElementById('dailyBudgetInput');
      const budget = parseFloat(budgetInput.value);
      
      if (!budget || budget <= 0) {
        alert("Please enter a valid daily budget amount.");
        return;
      }
      
      dailyBudget = budget;
      budgetInput.value = '';
      updateChart();
      
      alert(`Daily budget set to ‚Ç±${budget.toFixed(2)}`);
    }

    // Scroll reveal animations
    function revealOnScroll() {
      const reveals = document.querySelectorAll('.scroll-reveal, .scroll-reveal-left, .scroll-reveal-right');
      
      reveals.forEach(element => {
        const windowHeight = window.innerHeight;
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        
        if (elementTop < windowHeight - elementVisible) {
          element.classList.add('revealed');
        }
      });
    }

    // Animate transactions when they appear
    function animateTransactions() {
      const transactions = document.querySelectorAll('.transaction-item:not(.animate-in)');
      transactions.forEach((transaction, index) => {
        setTimeout(() => {
          transaction.classList.add('animate-in');
        }, index * 100);
      });
    }

    // Enhanced display transactions with animations
    const originalDisplayTransactions = displayTransactions;
    displayTransactions = function() {
      originalDisplayTransactions();
      
      // Add animation delay for new transactions
      setTimeout(() => {
        animateTransactions();
      }, 50);
    };

    // Scroll event listener
    window.addEventListener('scroll', revealOnScroll);
    window.addEventListener('load', revealOnScroll);

    // Smooth scroll behavior for the page
    document.documentElement.style.scrollBehavior = 'smooth';

    // Add entrance animations to stats
    function animateStats() {
      const stats = document.querySelectorAll('.stat-item');
      stats.forEach((stat, index) => {
        stat.style.animationDelay = `${index * 0.1}s`;
        stat.style.animation = 'fadeInUp 0.6s ease-out forwards';
      });
    }

    // Initialize
    updateChart();
    displayTransactions();
    
    // Trigger initial animations
    setTimeout(() => {
      revealOnScroll();
      animateStats();
    }, 100);
  </script>
<!-- Firebase SDKs v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBYNMUDx4qvN0MekL93TNjUZwnekjfoW_s",
    authDomain: "track-5eed9.firebaseapp.com",
    projectId: "track-5eed9",
    storageBucket: "track-5eed9.appspot.com",
    messagingSenderId: "737029422017",
    appId: "1:737029422017:web:8dfc2a92422a8a1ce74d40"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const docRef = db.collection("wallets").doc("shared");

  // Load data from Firebase on page load
  docRef.onSnapshot((doc) => {
    const data = doc.data();
    if (data?.expenses) {
      transactions = data.expenses;
      // Recalculate totals from Firebase data
      totalIncome = 0;
      totalExpenses = 0;
      transactions.forEach(transaction => {
        if (transaction.type === 'income') {
          totalIncome += transaction.amount;
        } else {
          totalExpenses += transaction.amount;
        }
      });
      displayTransactions();
      updateChart();
    }
  });

  // Override the original addTransaction function for Firebase integration
  const originalAddTransaction = addTransaction;
  addTransaction = async function() {
    const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
    const category = document.getElementById('categoryInput').value.trim();
    const amount = parseFloat(document.getElementById('amount').value);
    const description = document.getElementById('description').value.trim();

    if (!amount || amount <= 0) {
      alert("Please enter a valid amount.");
      return;
    }

    if (!category) {
      alert("Please enter what type of " + transactionType + " this is.");
      return;
    }

    const transaction = {
      id: Date.now(),
      category: category,
      amount: amount,
      description: description || 'No description',
      date: new Date().toLocaleString(),
      rawDate: new Date(),
      type: transactionType
    };

    transactions.unshift(transaction);

    if (transactionType === 'income') {
      totalIncome += amount;
    } else {
      totalExpenses += amount;
    }

    // Clear form
    document.getElementById('categoryInput').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('description').value = '';

    // Save to Firebase
    try {
      await docRef.set({ expenses: transactions });
    } catch (error) {
      console.error("Error saving to Firebase:", error);
      alert("Error saving transaction. Please try again.");
    }

    updateChart();
    displayTransactions();
  };

  // Override the original deleteTransaction function for Firebase integration
  const originalDeleteTransaction = deleteTransaction;
  deleteTransaction = async function(id) {
    const transaction = transactions.find(t => t.id === id);
    if (!transaction) return;

    if (confirm('Are you sure you want to delete this transaction?')) {
      transactions = transactions.filter(t => t.id !== id);
      
      if (transaction.type === 'income') {
        totalIncome -= transaction.amount;
      } else {
        totalExpenses -= transaction.amount;
      }

      // Save to Firebase
      try {
        await docRef.set({ expenses: transactions });
      } catch (error) {
        console.error("Error deleting from Firebase:", error);
        alert("Error deleting transaction. Please try again.");
      }

      updateChart();
      displayTransactions();
    }
  };
</script>
</body>
</html>
